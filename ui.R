library(shiny)
library(shinyjs)
library(shinyBS)
library(ggplot2)
library(V8)
library(shinydashboard)

#Use jscode to for reset button to reload the app
jsResetCode <- "shinyjs.reset = function() {history.go(0)}"


ui <- dashboardPage(skin = "black",
  dashboardHeader(title = "Random Assignment",
                  titleWidth = 195),
  dashboardSidebar(width = 195,
    sidebarMenu(
      id = "tabs",
      menuItem("Instruction", tabName = "instruction", icon = icon("dashboard")),
      menuItem("Generated by Hand", tabName = "hand", icon = icon("hand-o-right")),
      menuItem("Hand-Selected Data", tabName = "summary", icon = icon("bar-chart")),
      menuItem("Generated by Computer", tabName = "computer", icon = icon("tv"))
    )
  ),
  dashboardBody(
    tags$head(
      tags$link(rel = "stylesheet", type = "text/css", href = "stylecssMouseExp.css")
    ),
    tabItems(
      tabItem(tabName = "instruction",
              fluidRow(
                column(11,offset = 1, uiOutput("about1"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(11,uiOutput("about2"))
              ),br(),
              fluidRow(
                column(11,offset = 1, uiOutput("background1"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(11,uiOutput("background2"))
              ),br(),
              fluidRow(
                column(11,offset = 1, uiOutput("instruction1"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(11,uiOutput("instruction2"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(11,uiOutput("instruction3"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(8,uiOutput("instruction4")),
                column(3,bsButton("go","Try the App >>",icon("ravelry"),style = "danger",size = "large",class = "circle grow"))
              ),br(),
              fluidRow(
                column(11,offset = 1, uiOutput("ack1"))
              ),
              fluidRow(
                column(1,img(src = "raspberry.png", width = 20)),
                column(11, uiOutput("ack2"))
              )
              
      ),
      tabItem(tabName = "hand",
              fluidPage(
                #Use jscode to for reset button to reload the app
                useShinyjs(),
                extendShinyjs(text = jsResetCode),
                #Use jscode to disable all the buttons
                tags$head(tags$script(HTML('
                                           Shiny.addCustomMessageHandler("jsCode",
                                           function(message) {
                                           console.log(message)
                                           eval(message.code);
                                           }
                                           );
                                           '))),
                
                titlePanel(h2("Please choose 10 Mice for the Raspberry Treatment")),
                br(),
                #Display all the mice in main panel
                fluidRow( column(1, bsButton("btn1",label = tags$img(src = 'brown3.png',width = 82))),
                          div(style = "position: relative; left: 50px;",column(3, offset = 1, bsButton("btn18",label = tags$img(src='brown3.png', width = 142)))),
                          column(2, bsButton("btn3",label = tags$img(src='black3.png', width = 90))),
                          column(4, bsButton("btn4",label = tags$img(src='black3.png', width = 90)))),
                          
                fluidRow( 
                          div(style = "position: relative; left: -20px; top: 3px",column(2, bsButton("btn6",label = tags$img(src='brown3.png', width = 97)))),
                          div(style = "position: relative; left: 20px; top: 15px",column(5, bsButton("btn20",label = tags$img(src='black3.png', width = 162)))),
                          div(style = "position: relative; left: 80px; top: -60px",column(2, bsButton("btn5",label = tags$img(src='brown3.png', width = 95)))),
                          div(style = "position: relative; left: 40px; top: -40px",column(1, bsButton("btn8",label = tags$img(src='black3.png', width = 92)))),
                          #div(style = "position: relative; left: -200px; top: -5px",
                              column(4, bsButton("btn10",label = tags$img(src='black3.png', width = 101))),
                          div(style = "position: relative; left: 0px; top: 12px",column(2, bsButton("btn7",label = tags$img(src='brown3.png', width = 101)))),
                          div(style = "position: relative; left: 0px; top: 12px",column(2, bsButton("btn11",label = tags$img(src='brown3.png', width = 102)))),
                          div(style = "position: relative; top: -50px", column(2, bsButton("btn12",label = tags$img(src='brown3.png', width = 113)))),
                          div(style = "position: relative; top: 20px; left: 40px;", column(2, bsButton("btn13",label = tags$img(src='black3.png', width = 122)))),
                          div(style = "position: relative; top: -15px; left: 30px;", column(2, bsButton("btn14",label = tags$img(src='brown3.png', width = 124)))),
                          div(style = "position: relative; top: 90px; left: -100px;", column(2, bsButton("btn15",label = tags$img(src='brown3.png', width = 126)))),
                          div(style = "position: relative; top: 20px; left: -100px;", column(2, bsButton("btn16",label = tags$img(src='black3.png', width = 126)))),
                          div(style = "position: relative; top: 80px; left: -150px;", column(2, bsButton("btn17",label = tags$img(src='brown3.png', width = 127)))),
                          div(style = "position: relative; top: -20px; left: 0px;", column(2, bsButton("btn19",label = tags$img(src='black3.png', width = 154)))) 
                          # div(style = "position: relative; left: 10px; top: 10px;",
                          #     bsButton("btn2",label = tags$img(src='brown3.png', width = 84))),
                          # bsButton("btn9",label = tags$img(src='black3.png', width = 101)),
                          # bsButton("btn2",label = tags$img(src='brown3.png', width = 84))
                          ),br(),br(),br(),br(),br(),br(),br(),br(),
                fluidRow(
                  bsButton("btn9",label = tags$img(src='black3.png', width = 101)),
                  bsButton("btn2",label = tags$img(src='brown3.png', width = 84))
                ),
                
                br(),hr(),
                fluidRow(
                  column(3,h3("You have selected")),
                  column(1,textOutput("number")),
                  column(1,h3("mice"))
                  ),
                fluidRow(
                  column(2,offset = 1, bsButton("reset_button", "Reset", style = "danger", icon = icon("refresh"), size = "large")),
                  bsPopover("reset_button",title = "Notice", "If you click more than 10 mice, click Reset to start again.", placement = "top"),
                  column(2,bsButton("submit","Submit Selection", style = "danger",icon = icon("hand-o-up"), size = "large", disabled = TRUE))),
                hr()
                
                
               
              )
      ),
      tabItem(tabName = "summary",
              fluidPage(
                div(style = "position:relative; left: 30px;", fluidRow(h2("Summary of the mice Hand-Selected for Comparison:"))),br(),br(),br(),
                conditionalPanel(
                  condition = "input.submit == 0",
                  fluidPage(
                    wellPanel(div(style = "position: relative; text-align: center;", icon("lock"), h3("Please choose 10 mice to unlock this page.")))
                  )
                ),
                conditionalPanel(
                  condition = "(output.number >= 10)&(input.submit != 0)",
                  fluidPage(
                    
                    fluidRow(column(12,
                                    wellPanel(
                                      fluidRow(
                                        column(2,""), column(2,"Total selected"), column(2,"Average Weight (g)"), column(2,"Average Age (wks)"), column(2,"Average Tumor Mass (mg)"), column(1,"Proportion Female"), column(1,"Proportion Brown")
                                      ), 
                                      fluidRow(
                                        column(2,"Rspb.Group"), column(2,"10"), column(2,textOutput("aveWeight")), column(2,textOutput("aveAge")), column(2,textOutput("aveTu")), column(1,textOutput("gend")), column(1,textOutput("col"))
                                      ),
                                      fluidRow(
                                        column(2,"Control Group"), column(2,"10"), column(2,textOutput("aveWeightC")), column(2,textOutput("aveAgeC")), column(2,textOutput("aveTuC")), column(1,textOutput("gendC")), column(1,textOutput("colC"))
                                      )
                                    )
                    )
                    ),
                    fluidRow(
                      div(style = "position:relative; left:-10px;", column(3,plotOutput("weight"))), column(3,plotOutput("age")), column(6,plotOutput("tumor")) 
                    ),
                    fluidRow(
                      div(style = "position:relative; left:-10px;", column(3,plotOutput("gender"))), column(3,plotOutput("color")),
                      div(style = "position:relative; left:50px;", column(6, div(style = "position:absolute; top: 3em; left: 10px",
                                    sliderInput("theta", 
                                                label = div(style='width: 400px;', 
                                                            div(style='float:left;', 'No Treatment Effect'), 
                                                            div(style='float:right;', 'Treatment Effect In Real Experiment')), 
                                                min = 0, max = 1, value = 0.6, width = '90%'))))
                    ), br(), br(), br(), br(), br(),
                    fluidRow(div(style = "position:relative; left: 60px; top: 240px", bsButton("compare","Compare with Random Selection", style = "danger")),
                      div(style = "position:relative; left: 60px; top: 100px", bsButton("getdata","Use Raw Data", style = "danger"))
                      
                    )), conditionalPanel("input.getdata != 0", verbatimTextOutput("dataf"))
                  
                )
              )),
      tabItem(tabName = "computer",
              fluidPage(
                wellPanel(
                  fluidRow(
                    column(2,numericInput("times", label = NULL, value = 1, min = 1)),
                    column(9,h4("Enter number to run multiple trials. (Hint: Try entering 10, 100, 1000, etc.)"))
                  )
                ),
                conditionalPanel(
                  condition = "input.times < 1",
                  fluidPage(
                    wellPanel(div(style = "position: relative; text-align: center;", icon("lock"), 
                                  h3("Warning: The input number has to be at least one.")))
                  )
                ),
                conditionalPanel(
                  condition = "input.times >= 1",
                  fluidRow(
                    column(6, tableOutput("computerTable")),
                    column(6, sliderInput("compTheta", 
                                          label = div(style='width:400px;', 
                                                      div(style='float:left;', 'No Treatment Effect'), 
                                                      div(style='float:right;', 'Treatment Effect In Real Experiment')), 
                                          min = 0, max = 1, value = 0.6, width = '400px'))
                  ), br(), br(), br(), br(), br(), br(), br(),
                  fluidRow(
                    column(3,plotOutput("compWeightBar")), column(3,plotOutput("compAgeBar")), column(6,plotOutput("compTumorBar"))
                  ),
                  fluidRow(
                    column(4,plotOutput("compWeightHist")), column(4,plotOutput("compAgeHist")), column(4,plotOutput("compTumorHist"))
                  ),
                  fluidRow(
                    div(style = "position:relative; top: -35px;", bsButton("compGetdata","Use the data from last trial", style = "danger"))
                  )
                  , conditionalPanel("input.compGetdata != 0", 
                                     column(6,verbatimTextOutput("compDataf"))
                  )
                )
                
              )
      )
    )
  )
)

